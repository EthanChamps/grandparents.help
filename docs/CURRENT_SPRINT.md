# Current Sprint

## Active Issues
- #10 - Design and Implement Database Schema - in progress
- #9 - Implement Authentication System - queued

## Goal
Define complete database schema for users, families, sessions, messages, events, and alerts.

## Approach

### Schema Design

```
┌─────────────┐       ┌─────────────────┐       ┌─────────────┐
│   users     │       │ family_members  │       │  families   │
├─────────────┤       ├─────────────────┤       ├─────────────┤
│ id (PK)     │──────<│ user_id (FK)    │>──────│ id (PK)     │
│ type        │       │ family_id (FK)  │       │ name        │
│ email       │       │ role            │       │ subscription│
│ phone       │       │ created_at      │       │ created_at  │
│ name        │       └─────────────────┘       └─────────────┘
│ created_at  │
└──────┬──────┘
       │
       │ 1:N
       ▼
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│  sessions   │       │  messages   │       │   alerts    │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │       │ id (PK)     │       │ id (PK)     │
│ user_id(FK) │       │ user_id(FK) │       │ user_id(FK) │
│ token       │       │ role        │       │ family_id   │
│ expires_at  │       │ content     │       │ type        │
│ created_at  │       │ image_url   │       │ scam_prob   │
└─────────────┘       │ created_at  │       │ image_url   │
                      └─────────────┘       │ ai_analysis │
                                            │ acknowledged│
┌─────────────┐                             │ created_at  │
│   events    │                             └─────────────┘
├─────────────┤
│ id (PK)     │
│ user_id(FK) │
│ event_type  │
│ metadata    │
│ created_at  │
└─────────────┘
```

### Key Decisions
1. **Single `users` table** with `type` field ('senior'|'family') - simpler than separate tables
2. **`family_members` junction** - allows one senior to have multiple family guardians
3. **Sessions stored in DB** - enables invalidation across devices
4. **UUID primary keys** - better for distributed systems, no sequential exposure
5. **Existing tables preserved** - `events` and `messages` already in use, just add FKs

### Migration Strategy
1. Create new tables first (users, families, family_members, sessions, alerts)
2. Alter existing tables to add foreign keys (events, messages)
3. Add indexes for common query patterns

## Definition of Done
- [x] SQL migration file created: `drizzle/0000_initial_schema.sql`
- [x] TypeScript types in `src/lib/db/schema.ts` (auto-generated by Drizzle)
- [x] db.ts updated with Drizzle client
- [x] Schema pushed to Neon
- [ ] Issue #10 closed with commit

## Risks
- Existing `events`/`messages` data may not have valid user_ids (currently null)
- Solution: Make user_id nullable with FK, backfill later
